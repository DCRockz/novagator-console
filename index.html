<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Novagator Developer Console</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Crect width='100%25' height='100%25' rx='12' ry='12' fill='%230b0f19'/%3E%3Cpath d='M20 44l8-20 8 14 8-20 8 26' stroke='%23b3e5ff' stroke-width='4' fill='none' stroke-linecap='round'/%3E%3Ccircle cx='48' cy='20' r='3' fill='%23b3e5ff'/%3E%3C/svg%3E">
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg: #0b0f19;
      --panel: #101623;
      --text: #e7eefb;
      --muted:#94a3b8;
      --accent:#5ee1ff;
      --accent-2:#7c4dff;
      --ok:#22c55e;
      --warn:#f59e0b;
      --err:#ef4444;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    @media (prefers-color-scheme: light){
      :root[data-theme="light"]{
        --bg:#f7fafc; --panel:#ffffff; --text:#0b1220; --muted:#475569; --accent:#0066ff; --accent-2:#7c4dff;
      }
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      display:flex; align-items:stretch; justify-content:center;
    }
    .wrap{width:min(1200px,100%); padding:16px}
    .console{
      background: linear-gradient(180deg, color-mix(in oklab, var(--panel) 90%, transparent) 0%, var(--panel) 100%);
      border:1px solid color-mix(in oklab, var(--panel), #ffffff 8%);
      border-radius:16px; padding:14px 14px 8px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
      min-height:70vh; display:flex; flex-direction:column; gap:10px
    }
    .header{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .title{display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.ok{background:var(--ok)} .dot.warn{background:var(--warn)} .dot.err{background:var(--err)}
    .badge{font:600 12px var(--mono); color:var(--accent); border:1px solid color-mix(in oklab,var(--accent),#000 60%); padding:2px 8px; border-radius:999px}
    .screen{flex:1; overflow:auto; padding:8px 6px; scrollbar-gutter: stable both-edges}
    .line{font-family:var(--mono); white-space:pre-wrap; word-break:break-word; line-height:1.45}
    .line.fade{color:var(--muted)}
    .line .ts{color:var(--muted); margin-right:8px}
    .line .tag{padding:1px 6px; border-radius:6px; margin-right:6px; font-weight:700}
    .tag.OUT{background:color-mix(in oklab, var(--accent) 30%, transparent); color:var(--accent)}
    .tag.SYS{background:color-mix(in oklab, var(--accent-2) 30%, transparent); color:var(--accent-2)}
    .tag.ERR{background:color-mix(in oklab, var(--err) 25%, transparent); color:var(--err)}
    .prompt-row{display:flex; align-items:flex-start; gap:10px}
    .prompt{font-family:var(--mono); color:var(--muted)}
    .input{
      flex:1; min-height:24px; outline:none; border:none; background:transparent; color:var(--text);
      font-family:var(--mono); font-size:14px; caret-color: var(--accent);
    }
    .input[contenteditable="true"]:empty:before{content:attr(data-placeholder); color:var(--muted)}
    .footer{display:flex; align-items:center; justify-content:space-between; gap:8px; color:var(--muted); font:12px var(--mono)}
    .kbd{border:1px solid color-mix(in oklab, var(--muted), #000 40%); padding:1px 6px; border-radius:6px; margin:0 2px}
    .toast{position:fixed; right:12px; bottom:12px; background:var(--panel); border:1px solid color-mix(in oklab,var(--panel),#fff 10%); color:var(--text); font:13px var(--mono); padding:8px 12px; border-radius:10px; opacity:0; transform: translateY(6px); transition:.3s}
    .toast.show{opacity:1; transform: translateY(0)}
    a, .link{color:var(--accent); text-decoration: none; border-bottom:1px dashed color-mix(in oklab,var(--accent),#000 65%)}
  </style>
</head>
<body>
<div class="wrap">
  <main class="console" role="region" aria-label="Developer console">
    <div class="header">
      <div class="title">
        <span class="dot ok" title="status: ok"></span>
        <span>Novagator Developer Console</span>
      </div>
      <div class="badge" id="ver">v1.0.0</div>
    </div>

    <section id="screen" class="screen" aria-live="polite"></section>

    <div class="prompt-row">
      <div class="prompt" aria-hidden="true">➜</div>
      <div id="input" class="input" contenteditable="true" spellcheck="false" role="textbox" aria-label="Console input" data-placeholder="Type a command… (try 'help')"></div>
    </div>

    <div class="footer">
      <div>
        Tips: <span class="kbd">↑/↓</span> history · <span class="kbd">Tab</span> autocomplete · <span class="kbd">Ctrl/⌘</span>+<span class="kbd">L</span> clear
      </div>
      <div id="themeIndicator">theme: auto</div>
    </div>
  </main>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const screen = $("#screen");
  const input = $("#input");
  const toastEl = $("#toast");
  const themeIndicator = $("#themeIndicator");
  const ver = $("#ver")?.textContent?.trim() || "v0.0.0";

  const state = {
    history: JSON.parse(localStorage.getItem("nv.history") || "[]"),
    histIdx: null,
    theme: localStorage.getItem("nv.theme") || "auto",
    commands: {},
  };

  function applyTheme(mode){
    const root = document.documentElement;
    if(mode === "auto"){ root.removeAttribute("data-theme"); }
    else { root.setAttribute("data-theme", mode); }
    state.theme = mode;
    localStorage.setItem("nv.theme", mode);
    themeIndicator.textContent = `theme: ${mode}`;
  }
  applyTheme(state.theme);

  const now = () => new Date().toLocaleTimeString();
  const escape = s => s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
  const print = (msg, tag="OUT", cls="") => {
    const el = document.createElement("div");
    el.className = `line ${cls}`;
    el.innerHTML = `<span class="ts">[${now()}]</span><span class="tag ${tag}">${tag}</span>${msg}`;
    screen.appendChild(el);
    screen.scrollTop = screen.scrollHeight;
  };
  const ok = msg => print(escape(msg), "OUT");
  const sys = msg => print(escape(msg), "SYS", "fade");
  const err = msg => print(escape(msg), "ERR");
  const toast = msg => { toastEl.textContent = msg; toastEl.classList.add("show"); setTimeout(() => toastEl.classList.remove("show"), 2200); };
  const saveHistory = () => localStorage.setItem("nv.history", JSON.stringify(state.history.slice(-500)));

  function calcExpr(expr){
    if(!/^[0-9+\-*/().,\s%^]*$/.test(expr)) throw new Error("Unsafe characters");
    const sanitized = expr.replace(/\^/g, "**").replace(/,/g,"");
    const fn = new Function(`return (${sanitized})`);
    const val = fn();
    if(Number.isFinite(val)) return val;
    throw new Error("Invalid expression");
  }

  const store = {
    get:k => JSON.parse(localStorage.getItem(k)),
    set:(k,v)=> localStorage.setItem(k, JSON.stringify(v)),
    del:k => localStorage.removeItem(k),
    keys:() => Object.keys(localStorage)
  };

  const commands = {
    help(){
      ok(`Available commands:
  help                      Show this help
  clear                     Clear screen
  echo <text>               Print text
  date / time               Current date/time
  theme <auto|light|dark>   Switch theme
  version                   Console version
  about                     About Novagator console
  uuid                      Generate a UUID
  calc <expr>               Evaluate math
  store keys|get|set|del    Local storage ops
  ascii <text>              Tiny ASCII banner
`);
    },
    clear(){ screen.innerHTML = ""; },
    echo(...args){ ok(args.join(" ")); },
    date(){ ok(new Date().toLocaleDateString()); },
    time(){ ok(new Date().toLocaleTimeString()); },
    theme(arg){
      const m = (arg||"").toLowerCase();
      if(!["auto","light","dark"].includes(m)) return err("Usage: theme <auto|light|dark>");
      applyTheme(m); ok(`Theme set to ${m}`);
    },
    version(){ ok(ver); },
    about(){
      ok("Novagator Developer Console — self-contained HTML tool for dev & QA.");
      sys("History stored locally. Type 'help' to explore commands.");
    },
    uuid(){
      const u = crypto.randomUUID();
      ok(u); navigator.clipboard?.writeText(u).then(()=>toast("UUID copied"));
    },
    calc(...args){
      const expr = args.join(" ").trim();
      if(!expr) return err("Usage: calc <expression>");
      try{ ok(String(calcExpr(expr))); }catch(e){ err("Calc error: " + e.message); }
    },
    store(sub, key, ...rest){
      switch((sub||"").toLowerCase()){
        case "keys": ok(store.keys().join(", ")); break;
        case "get": if(!key) return err("Usage: store get <key>"); ok(JSON.stringify(store.get(key),null,2)); break;
        case "set": if(!key) return err("Usage: store set <key> <json|text>"); let val; try{ val = JSON.parse(rest.join(" ")); }catch{ val = rest.join(" "); } store.set(key,val); ok("OK"); break;
        case "del": if(!key) return err("Usage: store del <key>"); store.del(key); ok("Deleted"); break;
        default: err("Usage: store keys|get|set|del …");
      }
    },
    ascii(...text){
      const s = (text.join(" ")||"NOVAGATOR").toUpperCase().slice(0,24);
      const banner = s.split("").map(ch=>ch===" "?"   ":ch).join(" ");
      ok(`+${"-".repeat(banner.length+2)}+\n| ${banner} |\n+${"-".repeat(banner.length+2)}+`);
    }
  };
  state.commands = commands;

  sys("Welcome to Novagator. Type 'help' to get started.");
  sys("Your command history persists locally. Use 'clear' to wipe the screen.");

  function runCommand(raw){
    const line = raw.trim();
    if(!line) return;
    if(state.history[state.history.length-1] !== line){ state.history.push(line); saveHistory(); }
    state.histIdx = null;
    print(escape("➜ " + line), "SYS");
    const [cmd, ...args] = line.split(/\s+/);
    const fn = state.commands[cmd?.toLowerCase()];
    if(!fn){ err(`Unknown command: ${cmd}. Try 'help'.`); return; }
    try{ const res = fn.apply(null, args); if(res instanceof Promise){ res.catch(e => err("Async error: " + e.message)); } }
    catch(e){ err(e?.message || String(e)); }
  }

  function complete(current){
    const keys = Object.keys(state.commands);
    const matches = keys.filter(k => k.startsWith(current.toLowerCase()));
    if(matches.length === 1) return matches[0] + " ";
    if(matches.length > 1) sys("Suggestions: " + matches.join(", "));
    return null;
  }

  function focusEnd(el){
    el.focus();
    const range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }
  focusEnd(input);

  input.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      const txt = input.textContent;
      input.textContent = "";
      runCommand(txt);
    } else if(e.key === "ArrowUp"){
      e.preventDefault();
      if(state.histIdx === null) state.histIdx = state.history.length;
      if(state.histIdx > 0){ state.histIdx--; input.textContent = state.history[state.histIdx] || ""; focusEnd(input); }
    } else if(e.key === "ArrowDown"){
      e.preventDefault();
      if(state.histIdx !== null){
        state.histIdx++;
        if(state.histIdx >= state.history.length){ state.histIdx = null; input.textContent = ""; }
        else { input.textContent = state.history[state.histIdx] || ""; }
        focusEnd(input);
      }
    } else if(e.key === "Tab"){
      e.preventDefault();
      const cur = input.textContent.trim();
      if(!cur) return;
      const comp = complete(cur);
      if(comp){ input.textContent = comp; focusEnd(input); }
    } else if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "l"){
      e.preventDefault();
      commands.clear(); sys("Screen cleared (Ctrl/⌘+L).");
    }
  });

  document.querySelector(".console").addEventListener("mousedown", () => setTimeout(()=>focusEnd(input), 0));

  print("Console ready.", "SYS", "fade");
})();
</script>
</body>
</html>
