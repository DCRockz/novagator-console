<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Novagator — Cockpit</title>
<style>
:root{
  --bg:#0B1220; --panel:#101827; --muted:#A1A8B3; --fg:#FFFFFF;
  --good:#00e5a8; --near:#6c5ce7; --warn:#ff5a5f; --gold:#ffd54f;
  --radius:14px; --shadow:0 10px 28px rgba(0,0,0,.35);
}
*{box-sizing:border-box} html,body{margin:0;background:#000;color:#fff;font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
.wrap{padding:14px 14px 24px;max-width:1200px;margin:0 auto}

/* Header cards */
.header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;background:linear-gradient(180deg,rgba(255,255,255,.07),rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.14);border-radius:var(--radius);padding:12px;backdrop-filter:blur(8px);box-shadow:var(--shadow)}
.brand{display:flex;align-items:center;gap:10px;min-width:240px}
.dot{width:12px;height:12px;border-radius:50%;box-shadow:0 0 14px currentColor}
.title{font-weight:800;letter-spacing:.02em;white-space:nowrap}
.stats{display:flex;gap:12px;flex:1;min-width:260px}
.card{background:var(--panel);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px 12px;min-width:130px;box-shadow:var(--shadow)}
.label{font-size:12px;color:var(--muted);letter-spacing:.02em}
.value{font-size:20px;font-weight:800;margin-top:2px}
.btn{margin-left:auto;appearance:none;border:none;cursor:pointer;background:#E5E7EB;color:#0B1220;font-weight:800;padding:10px 14px;border-radius:12px}
.btn:hover{background:#D1D5DB}

/* Ticker */
.ticker{position:relative;width:100%;overflow:hidden;margin-top:12px;border-radius:var(--radius);border:1px solid rgba(255,255,255,.12);background:#0B1220;box-shadow:var(--shadow);padding:8px 0}
.ticker.hidden{display:none}
.rail{position:relative;height:48px}
.rail span{position:absolute;top:50%;transform:translateY(-50%);will-change:transform;padding-left:16px;white-space:nowrap;font-size:20px;font-weight:700;color:#fff;text-shadow:0 0 10px rgba(0,0,0,.85)}
.ticker::before,.ticker::after{content:"";position:absolute;top:0;width:56px;height:100%;pointer-events:none}
.ticker::before{left:0;background:linear-gradient(90deg,var(--bg),rgba(11,18,32,0))}
.ticker::after{right:0;background:linear-gradient(270deg,var(--bg),rgba(11,18,32,0))}
.glow-good{text-shadow:0 0 16px rgba(0,229,168,.9)}
.glow-near{text-shadow:0 0 16px rgba(108,92,231,.9)}
.glow-warn{text-shadow:0 0 16px rgba(255,90,95,.95)}
.smallnote{color:#9ca3af;font-size:12px;margin-top:6px}

/* Chart card */
.nv-analytics-card{background:#101827;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px;box-shadow:var(--shadow);margin-top:12px}
.nv-analytics-title{font-size:12px;color:#A1A8B3;margin-bottom:6px}
.nv-analytics-note{color:#9ca3af;font-size:12px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="brand">
      <span class="dot" id="statusDot" style="color:#00e5a8"></span>
      <span class="title">Novagator — Daily Snapshot</span>
    </div>
    <div class="stats">
      <div class="card"><div class="label">Revenue £</div><div class="value" id="revenueVal">—</div></div>
      <div class="card"><div class="label">7-Day Avg £</div><div class="value" id="avgVal">—</div></div>
      <div class="card"><div class="label">Status</div><div class="value" id="statusVal">—</div></div>
    </div>
    <button class="btn" id="toggle">Hide ticker</button>
  </div>

  <div class="ticker" id="ticker">
    <div class="rail"><span id="t1">Loading…</span><span id="t2" aria-hidden="true"></span></div>
  </div>
  <div class="smallnote" id="note"></div>

  <div class="nv-analytics-card">
    <div class="nv-analytics-title">7-Day Performance (Revenue)</div>
    <canvas id="nvChart" width="980" height="140"></canvas>
    <div id="nvNote" class="nv-analytics-note"></div>
  </div>
</div>

<script>
/* ======= CONFIG (wired to your Google Sheets) ======= */
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTpSc6IVhZlP1U_4T6QvquApQ5_qOXzNCDZxFN5JQBx16V4kZqCmbMY0RvCwGYIsaPSAQwAdqYZlfFY/pub?gid=930492670&single=true&output=csv"; // ticker line
const HISTORY_CSV =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCnU61jrOH2HPVgLgMw6tUvmpltHGzmChl5Nb1J-k6rN3ulyYFa2UCFaR_qQYK9h6irHlAP3KCJCOm/pub?gid=465604692&single=true&output=csv"; // 7-day series

/* ===== controls & helpers ===== */
const revEl = document.getElementById("revenueVal");
const avgEl = document.getElementById("avgVal");
const statusEl = document.getElementById("statusVal");
const statusDot = document.getElementById("statusDot");
const ticker = document.getElementById("ticker");
const toggleBtn = document.getElementById("toggle");
const rail = document.querySelector(".rail");
const note = document.getElementById("note");
let t1,t2;

function parseNum(s){return s?parseFloat(String(s).replace(/[^0-9.\-]+/g,"")):NaN;}
function extractValues(line){
  const rev = line.match(/Revenue[^0-9\-]*([0-9.,]+)/i);
  const avg = line.match(/7[- ]?Day Avg[^0-9\-]*([0-9.,]+)/i);
  const st  = line.match(/Status:\s*([A-Za-z ]+)/i);
  return { revenue: rev?parseNum(rev[1]):NaN, avg: avg?parseNum(avg[1]):NaN, status: st?st[1].trim():"—" };
}
function animateCount(el,toVal,dur=800){
  const from = parseFloat(el.dataset.value||"0")||0, t0=performance.now();
  function f(t){
    const p=Math.min(1,(t-t0)/dur), v=from+(toVal-from)*(1-Math.pow(1-p,3));
    el.textContent=Number(v.toFixed(0)).toLocaleString();
    if(p<1) requestAnimationFrame(f); else el.dataset.value=String(toVal);
  } requestAnimationFrame(f);
}
function setHeadline(line){
  const {revenue,avg,status}=extractValues(line);
  if(isNaN(revenue)){revEl.textContent="—";revEl.dataset.value="0"} else animateCount(revEl,Math.round(revenue));
  if(isNaN(avg)){avgEl.textContent="—";avgEl.dataset.value="0"} else animateCount(avgEl,Math.round(avg));
  statusEl.textContent=status||"—";
  [t1,t2].forEach(el=>el?.classList.remove("glow-good","glow-near","glow-warn"));
  if(!isNaN(revenue)&&!isNaN(avg)){
    if(revenue>=1000){statusDot.style.color="#ffd54f";t1?.classList.add("glow-near");t2?.classList.add("glow-near")}
    else if(revenue>=avg){statusDot.style.color="#00e5a8";t1?.classList.add("glow-good");t2?.classList.add("glow-good")}
    else {statusDot.style.color="#ff5a5f";t1?.classList.add("glow-warn");t2?.classList.add("glow-warn")}
  } else { statusDot.style.color="#00e5a8"; }
}
function initTicker(text){
  rail.innerHTML=""; t1=document.createElement("span"); t2=document.createElement("span");
  const payload = text.endsWith(" • ")?text:(text+"   •   ");
  t1.textContent=payload; t2.textContent=payload; rail.append(t1,t2);
  let x1=0; const w=()=>t1.getBoundingClientRect().width; let x2=w()+72; const step=120/60;
  (function loop(){ x1-=step; x2-=step; const ww=w(); if(x1<-ww) x1=x2+ww+72; if(x2<-ww) x2=x1+ww+72;
    t1.style.transform=`translate(${x1}px,-50%)`; t2.style.transform=`translate(${x2}px,-50%)`; requestAnimationFrame(loop); })();
}
async function fetchText(url,ms=3500){
  const ctrl=new AbortController(); const id=setTimeout(()=>ctrl.abort(),ms);
  try{const r=await fetch(url,{cache:"no-store",signal:ctrl.signal}); clearTimeout(id); return await r.text();}
  catch(e){clearTimeout(id); throw e;}
}
async function loadTicker(){
  try{
    const raw=await fetchText(CSV_URL,3500);
    let line=(raw.trim().split(/\r?\n/))[0]; if(line.startsWith('"')&&line.endsWith('"')) line=line.slice(1,-1);
    initTicker(line); setHeadline(line); note.textContent="";
  }catch(e){
    const demo="Today: 14 Aug 2025 • TikTok: 1450 • Instagram: 940 • YouTube: 920 • Total Views: 3310 • Revenue £: 300 • 7-Day Avg £: 280 • Status: Green";
    initTicker(demo); setHeadline(demo); note.textContent="Offline mode: showing demo until the CSV is reachable.";
  }
}
toggleBtn.addEventListener("click",()=>{const h=ticker.classList.toggle("hidden"); toggleBtn.textContent=h?"Show ticker":"Hide ticker";});

/* Sparkline */
(function(){
  const c=document.getElementById("nvChart"), ctx=c.getContext("2d"), n=document.getElementById("nvNote");
  function draw(values,col="rgba(108,92,231,0.95)"){
    const W=c.width,H=c.height,pad=8; ctx.clearRect(0,0,W,H);
    ctx.globalAlpha=.08; ctx.fillStyle="#fff";
    for(let x=0;x<=W;x+=90) ctx.fillRect(x,0,1,H);
    for(let y=0;y<=H;y+=28) ctx.fillRect(0,y,W,1);
    ctx.globalAlpha=1;
    if(!values?.length) return;
    const min=Math.min(...values), max=Math.max(...values), norm=v=>H-pad-((v-min)/(max-min||1))*(H-2*pad);
    ctx.strokeStyle=col; ctx.lineWidth=2; ctx.beginPath();
    values.forEach((v,i)=>{const x=pad+i*((W-2*pad)/Math.max(1,values.length-1)), y=norm(v); i?ctx.lineTo(x,y):ctx.moveTo(x,y);});
    ctx.stroke();
  }
  async function loadHistory(){
    try{
      const raw=(await fetch(HISTORY_CSV,{cache:"no-store"})).text ? await (await fetch(HISTORY_CSV,{cache:"no-store"})).text() : "";
      const lines=raw.trim().split(/\r?\n/).filter(Boolean).slice(-7);
      const values=lines.map(l=>{const parts=l.split(/[;,]/).map(s=>s.trim()); const last=parts[parts.length-1]; const num=parseFloat(String(last).replace(/[^0-9.\-]+/g,"")); return isNaN(num)?0:num;});
      if(values.length){ draw(values); n.textContent="" } else { n.textContent="No numeric values parsed."; draw([120,160,180,210,190,260,300]); }
    }catch(e){ n.textContent="Analytics source unavailable. Showing demo trend."; draw([120,160,180,210,190,260,300]); }
  }
  loadHistory();
  setInterval(()=>{ loadTicker(); loadHistory(); }, 5*60*1000);
})();

/* boot */
loadTicker();

/* env badge (optional) */
(function(){
  const p=new URLSearchParams(location.search).get("env")||"prod";
  document.title=`Novagator — Cockpit (${p})`;
})();
</script>
</body>
</html>
